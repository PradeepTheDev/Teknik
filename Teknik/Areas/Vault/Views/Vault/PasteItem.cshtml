@model Teknik.Areas.Vault.ViewModels.PasteItemViewModel

@{
    string format = Model.Paste.Syntax;
    string formatName = "Text";
    bool useFormat = true;
    bool autoDetect = false;

    if (string.IsNullOrEmpty(format))
    {
        useFormat = false;
    }
    else if (format == "auto-detect")
    {
        formatName = "Auto Detect";
        autoDetect = true;
    }
    else if (!HighlightHelper.Languages.ContainsKey(format))
    {
        useFormat = false;
    }
    else
    {
        formatName = HighlightHelper.Languages[format];
    }
}
<div class="panel panel-default">
    <div class="panel-heading">
        <div class="row">
            <div class="col-sm-10 text-left">
                <h4><b>@((string.IsNullOrEmpty(Model.Title)) ? "Paste" : Model.Title)</b> <small>Pasted on <time datetime="@Model.Paste.DatePosted.ToString("s")">@Model.Paste.DatePosted.ToString("dddd, MMMM d, yyyy") at @Model.Paste.DatePosted.ToString("h:mm:ss tt")</time> - Format: <b id="syntaxLanguage_@(Model.Paste.PasteId)">@formatName</b></small></h4>
            </div>
            <div class="col-sm-2 text-right">
                <h4><small><a href="@Url.SubRouteUrl("p", "Paste.View", new { url = Model.Paste.Url })" target="_blank">Direct Link</a></small></h4>
            </div>
        </div>
    </div>
    <div class="panel-body">
        <div class="row">
            <div class="col-sm-12 pull-left">
                <div class="btn-group" role="group">
                    <a role="button" class="btn btn-default" href="@Url.SubRouteUrl("p", "Paste.Simple", new { url = Model.Paste.Url })" target="_blank">Simple</a>
                    <a role="button" class="btn btn-default" href="@Url.SubRouteUrl("p", "Paste.Raw", new { url = Model.Paste.Url })" target="_blank">Raw</a>
                    <a role="button" class="btn btn-default" href="@Url.SubRouteUrl("p", "Paste.Download", new { url = Model.Paste.Url })">Download</a>
                </div>
            </div>
        </div>
        <br />
        <div class="row paste-item">
            <div class="col-sm-12 paste-content hideContent" id="@Model.VaultItemId">
                @if (!string.IsNullOrEmpty(Model.Paste.HashedPassword))
                {
                    <p class="text-center">Password Required</p>
                }
                else
                {
                    <pre><code id="code_@(Model.Paste.PasteId)">@Model.Paste.Content</code></pre>
                }
            </div>
            <div class="show-more" id="show-more-bottom-@Model.VaultItemId">
                <button role="button" class="btn btn-default btn-sm show-more-button">Show More</button>
            </div>
        </div>
    </div>
    @if (!string.IsNullOrEmpty(Model.Description))
    {
        <div class="panel-footer">
            <p>@Model.Description</p>
        </div>
    }
</div>

@if (useFormat)
{
    <script>
        var code = document.querySelector('#code_@(Model.Paste.PasteId)');
        var worker = new Worker(GenerateBlobURL('@Url.FullURL("~/js/highlight.worker.min.js")'));
        var scriptBlob = GenerateBlobURL('@Url.FullURL("~/js/highlight.min.js")');
        worker.onmessage = function (event) {
            code.innerHTML = event.data.value;
            @if (autoDetect)
            {
                @:$('#syntaxLanguage_@(Model.Paste.PasteId)').html('Auto Detect (' + event.data.language + ')');
            }
        }
        worker.postMessage({
            content: code.textContent,
            script: scriptBlob,
            format: '@(format)',
            autoDetect: @(autoDetect.ToString().ToLower())
        });
    </script>
}